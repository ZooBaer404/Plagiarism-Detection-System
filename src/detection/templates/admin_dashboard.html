{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="min-h-screen flex flex-col bg-slate-50 text-slate-900">

  <!-- ================= HEADER ================= -->
  <header class="flex justify-between items-center px-5 py-3 bg-white border-b shadow-sm">
      <a href="{% url 'admin_dashboard' %}" class="text-xl font-semibold text-slate-700">
         Plagiarism Detection
      </a>

      <h1 class="text-lg font-medium text-slate-600">Admin Dashboard</h1>

      <a href="{% url 'admin_account' %}"
         class="flex items-center justify-center w-9 h-9 rounded-full bg-slate-200 text-slate-700 font-semibold hover:bg-slate-300 transition">
         A
      </a>
  </header>

  <!-- ================= MAIN ================= -->
  <main class="grid grid-cols-12 gap-4 p-4 flex-1">

      <!-- LEFT COLUMN -->
      <section class="col-span-3 grid grid-rows-2 gap-4 max-h-[700px]">

          <!-- Approved Universities -->
          <div class="bg-white rounded-xl border p-3 flex flex-col">
              <h2 class="text-base font-semibold text-slate-700 mb-2">
                  <a href="{% url 'admin_universities' %}" class="hover:text-blue-600">Universities</a>
              </h2>

              <div class="flex flex-col gap-2 overflow-y-auto max-h-60">
                  {% for approved_uni in approved_unis %}
                  <div class="bg-slate-50 border rounded-lg p-2 text-slate-700 hover:bg-slate-100 transition text-sm">
                      {{ approved_uni.university_name }}
                  </div>
                  {% endfor %}
              </div>
          </div>

          <!-- Pending Approval -->
          <div class="bg-white rounded-xl border p-3 flex flex-col">
              <h2 class="text-base font-semibold text-slate-700 mb-2">
                  <a href="{% url 'admin_universities' %}" class="hover:text-blue-600">Pending Approval</a>
              </h2>

              <div class="flex flex-col gap-2 overflow-y-auto max-h-60">
                  {% for pending_uni in pending_unis %}
                  <div class="bg-yellow-50 border border-yellow-400 rounded-lg p-2 text-yellow-700 hover:bg-yellow-100 transition text-sm">
                      {{ pending_uni.university_name }}
                  </div>
                  {% endfor %}
              </div>
          </div>

      </section>

      <!-- CENTER: Latest Reports -->
      <section class="col-span-4 bg-white rounded-xl border p-3 flex flex-col max-h-[700px]">
          <h2 class="text-base font-semibold text-slate-700 mb-2">
              <a href="{% url 'admin_reports' %}" class="hover:text-blue-600">Latest Reports</a>
          </h2>

          <div class="flex flex-col gap-2 overflow-y-auto">
              {% for latest_report in latest_reports %}
              <div class="p-3 bg-slate-50 rounded-lg border hover:bg-slate-100 transition">
                  <p class="text-sm"><strong>University:</strong> 
                     {{ latest_report.checking_document_id.instructor_id.university_id.university_name }}
                  </p>
                  <p class="text-xs text-slate-500 mt-1">
                     Sent: {{ latest_report.checking_document_id.checking_document_name }}
                  </p>
                  <p class="text-xs mt-1">
                     <span class="font-semibold text-blue-600">{{ latest_report.report_result }}%</span> match
                  </p>
              </div>
              {% endfor %}
          </div>
      </section>

      <!-- RIGHT: Activities -->
      <section class="col-span-5 bg-white rounded-xl border p-3 flex flex-col max-h-[700px]">
          <h2 class="text-base font-semibold text-slate-700 mb-2">
              <a href="{% url 'admin_activities' %}" class="hover:text-blue-600">Latest Activities</a>
          </h2>

          <div class="flex flex-col gap-2 overflow-y-auto">

              {% for activity in latest_instructor_activities %}
              <div class="p-3 bg-slate-50 rounded-lg border hover:bg-slate-100 transition text-sm">
                  <p class="text-xs text-slate-500">
                      <strong>{{ activity.created_at|timesince }}</strong>
                  </p>
                  <p class="mt-1">
                      Instructor <strong>{{ activity.instructor_id.last_name }}</strong>
                      ({{ activity.instructor_id.university_id.university_name }})
                      uploaded a document.
                  </p>
              </div>
              {% endfor %}

              {% for activity in latest_university_activities %}
              <div class="p-3 bg-blue-50 border border-blue-300 rounded-lg hover:bg-blue-100 transition text-sm">
                  <p><strong>{{ activity.university_id.university_name }}</strong></p>
                  <p class="text-xs mt-1 text-blue-900">Submitted repository</p>
              </div>
              {% endfor %}

          </div>
      </section>

      <!-- BOTTOM: System Overview -->
      <section class="col-span-12 bg-white rounded-xl border p-4 flex flex-col">
          <h2 class="text-lg font-semibold text-slate-700 mb-3">System Overview</h2>

          <div class="grid grid-cols-3 gap-4">

              <div class="bg-slate-50 border rounded-xl p-4 flex flex-col items-center">
                  <p class="text-sm text-slate-500">Total Universities</p>
                  <p class="text-2xl font-semibold text-slate-800">{{ total_universities }}</p>
              </div>

              <div class="bg-slate-50 border rounded-xl p-4 flex flex-col items-center">
                  <p class="text-sm text-slate-500">Total Instructors</p>
                  <p class="text-2xl font-semibold text-slate-800">{{ total_instructors }}</p>
              </div>

              <div class="bg-slate-50 border rounded-xl p-4 flex flex-col items-center">
                  <p class="text-sm text-slate-500">Documents Processed</p>
                  <p class="text-2xl font-semibold text-slate-800">{{ total_documents_processed }}</p>
              </div>

          </div>
      </section>

  </main>

</div>

{% endblock %}
