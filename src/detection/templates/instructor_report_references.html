{% extends "base.html" %}
{% load static %}

{% block content %}
<!-- =========================================================
     PAGE: Instructor Report Overview
     DESCRIPTION:
       Displays a detailed plagiarism report summary for a
       selected document. Includes similarity score,
       statistics, matching sources, and text comparison.
   ========================================================= -->

<div class="report-container h-full bg-amber-100 flex flex-col gap-1">

    <!-- =========================================
       HEADER SECTION
       ========================================= -->
    <header class="instructor-header flex justify-between p-2 flex-none">
        <!-- Logo/Title -->
        <a href="{% url 'instructor_dashboard' %}"
            class="brand-title text-4xl">Plagiarism Detection</a>

        <!-- Page Title -->
        <h1 class="page-title text-2xl">Instructor Report</h1>

        <!-- Profile Icon -->
        <a href="{% url 'instructor_account' %}"
            class="profile-icon border-2 p-2"
            title="Account Info">
            <span>I</span>
        </a>
    </header>

    <main class="p-3 flex-1 flex flex-col">

        <p class="text-2xl flex-none">References</p>
        <div class="grid grid-cols-2 gap-3 p-2 flex-1 overflow-y-auto border-2 border-neutral-700 max-h-[950px]">


        {% for checking, research in paired_references %}
            {% with before=checking.0 current=checking.1 after=checking.2 %}
            {% with rbefore=research.0 rcurrent=research.1 rafter=research.2 %}
            
            <!-- Checking side -->
            <div class="p-2 border-2 border-neutral-700">
                <p class="text-xs">
                {% for sentence in before %}
                    {% if forloop.first %}
                    <a href="{% url 'instructor_report_view_content_sentence' document.id current.id %}"><span class="text-xs font-bold">
                        {{ sentence.checking_document_id.checking_document_name }} - Sentence #{{ sentence.sentence_index|add:1 }}
                    </span></a><br />
                    {% endif %}
                    {{ sentence.sentence_enhanced_text }}
                {% endfor %}
                <span class="bg-red-400 block">{{ current.sentence_enhanced_text }}</span>
                {% for sentence in after %}
                    {{ sentence.sentence_enhanced_text }}
                {% endfor %}
                </p>
            </div>

            <!-- Research side -->
            <div class="p-2 border-2 border-neutral-700">
                <p class="text-xs">
                {% for sentence in rbefore %}
                    {% if forloop.first %}
                    <span class="text-xs font-bold">
                        {{ sentence.research_document_id.research_document_file.name }} - Sentence #{{ sentence.sentence_index|add:1 }}
                    </span><br />
                    {% endif %}
                    {{ sentence.sentence_enhanced_text }}
                {% endfor %}
                <span class="bg-red-400 block">{{ rcurrent.sentence_enhanced_text }}</span>
                {% for sentence in rafter %}
                    {{ sentence.sentence_enhanced_text }}
                {% endfor %}
                </p>
            </div>

            {% endwith %}
            {% endwith %}
        {% endfor %}

        </div>

    </main>
</div>
{% endblock %}
